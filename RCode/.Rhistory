set.seed(7353)
setwd("C:/Github/Study_CrossoverDesign/RCode")
sim_time=2000
seq_size<-c(25,50,100,200)
cor_param=0.1
cros_type='ABBA'
#tao,eta,gamma,delta
params = matrix(c(1.0, 0.7, 0.3, 0.2), nrow=1,ncol=4)
#link of mean.i11,mean.mean.i12,mean.i21,mean.22
x.mat  <-  matrix(c(1,0,0,0,1,1,1,0,1,1,0,1,1,0,1,1), nrow = 4, ncol = 4)
mean_true=exp(params%*%x.mat)
pi=(seq_size)/(seq_size*2)
I<- matrix(0, nrow = 4, ncol = 4)
for (i in 1:nchar(cros_type) ){ I[i,]<-pi*mean_true%*%(t(x.mat)*x.mat[i,])}
data <-  matrix(0, nrow = 100, ncol = 4)
for (i in 1:length(mean_true)) {data[,i] =rpois(100, lambda = mean_true[1,i])}
#check hessian==I?
negll <- function(param) { sum(factorial(data))
-sum( param[1]*data[,1]-exp(param[1])+sum(param[1:3])*data[,2]-exp(sum(param[1:3]))+(param[1]+param[2]+param[4])*data[,3]-exp(param[1]+param[2]+param[4])+(param[1]+param[3]+param[4])*data[,4]-exp(param[1]+param[3]+param[4]) )}
ABBA<-optim(param <- c(0.95, 0.65, 0.25, 0.15), negll, hessian=TRUE)
ABBA
solve(ABBA$hessian)*200
I
solve(I)
I
solve(ABBA$hessian)*200
ABBA$hessian/200
solve(ABBA$hessian)*200
solve(I)
I
ABBA$hessian/200
y.sum=colSums(data)
tao.hat=log(y.sum[1]/100)
eta.hat=0.5*(log(y.sum[2])+log(y.sum[3])-log(y.sum[1])-log(y.sum[4]))
gamma.hat=0.5*(log(y.sum[2])+log(y.sum[4])-log(y.sum[1])-log(y.sum[3]))
delta.hat=0.5*(log(y.sum[3])+log(y.sum[4])-log(y.sum[1])-log(y.sum[2]))
mle = matrix(c(tao.hat, eta.hat, gamma.hat, delta.hat), nrow=1,ncol=4)
mean_est<-exp(mle%*%x.mat)
I.hat<- matrix(0, nrow = 4, ncol = 4)
for (i in 1:nchar(cros_type) ){ I.hat[i,]<-pi*mean_est%*%(t(x.mat)*x.mat[i,])}
score<- matrix(0, nrow = 100, ncol = 4)
for (i in 1:length(params) ){ score[,i]<-sweep(data, 2, mean_est[1,])%*%x.mat[i,]}
V.hat<- matrix(0, nrow = 4, ncol = 4)
for (i in 1:length(params) ){ V.hat[i,]<-colSums(score*score[,i])/200}
V.hat
I.hat
I
ABBA$hessian/200
solve(I.hat)
solve(ABBA$hessian)*200
corr(data)
ABBA
